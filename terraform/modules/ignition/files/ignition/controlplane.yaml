---
passwd:
  users:
    - name: core
      #passwordHash: "$6$GI6WEr/QbbSU2Zlz$9IprayV5yca8EZ9/f8JY3TfvkpLhkXRhpf56/sWewfK1GvGitVJyK7QxDYuNELLutpEuTLZqbI7.iJ/UWwS8R1"
      #passwordHash: "$5$UFyCCu/pVU3rPh/j$iE3uFm29i7O43uiwd6CMLo3jKctwREp3jYdDvgr1y96"
      #passwordHash: "$2y$12$IsvMTwss22CAcCkWOg6iaO0ndyGb.J/TQbPn3lApyjGoIGWUiFUyy"
      password_hash: "$6$ZNMzD3grp4I1qh2M$ealDCpCXIfpfez6YchyG4EWwUDP9Q0g7JRfXRyLaAL1GBx42Hb4OPhFSeWEP.o99TZK289g8rClOpOS8fFqZk0"
        #    - path: /home/core/works
        #      filesystem: root
        #      mode: 0755
        #      contents:
        #        inline: |
        #          #!/bin/bash
        #          set -euo pipefail
        #          # This script demonstrates how templating and variable substitution works when using Terraform templates for Container Linux Configs.
        #          hostname="$(hostname)"
        #          echo My name is fasdf  and the hostname is $${hostname}
storage:
  files:
    - path: /opt/bin/kubectl
      filesystem: root
      mode: 0755
      contents:
        remote:
          url: "https://dl.k8s.io/release/v${kubernetes_version}/bin/linux/arm64/kubectl"
          verification:
            hash:
              function: sha512
              sum: ${kubectl_sha512}
    - path: /opt/bin/kubelet
      filesystem: root
      mode: 0755
      contents:
        remote:
          url: "https://dl.k8s.io/release/v${kubernetes_version}/bin/linux/arm64/kubelet"
          verification:
            hash:
              function: sha512
              sum: ${kubelet_sha512}
    - path: /etc/modules-load.d/k8s.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          nf_conntrack
          br_netfilter
          overlay
    - path: /etc/sysctl.d/k8s.conf
      filesystem: root
      mode: 0644
      contents:
        # https://github.com/kubernetes/kubernetes/issues/66241
        inline: |
          vm.overcommit_memory=1
          kernel.panic=10
          kernel.panic_on_oops=1
          net.bridge.bridge-nf-call-ip6tables = 1
          net.ipv4.ip_forward                 = 1
          net.bridge.bridge-nf-call-iptables = 1
systemd:
  units:
    - name: kubelet.service
      enabled: true
      contents: |
        [Unit]
        Description=Kubernetes Kubelet
        Documentation=https://github.com/kubernetes/kubernetes
        After=docker.service
        Requires=docker.service

        [Service]
        ExecStart=/opt/bin/kubelet \
          --config=/var/lib/kubelet/config.yaml \
          --bootstrap-kubeconfig=/var/lib/kubelet/bootstrap-kubeconfig \
          --kubeconfig=/var/lib/kubelet/kubelet.kubeconfig \
          --container-runtime=remote \
          --container-runtime-endpoint=unix:///run/containerd/containerd.sock
        Restart=always
        RestartSec=10
        RestartLimitInterval=0

        [Install]
        WantedBy=multi-user.target
